<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/" />
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=1" />
    <meta name="color-scheme" content="light dark" />
    <link rel="icon" href="favicon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    
    <!-- Estilos SIN MINIFICAR -->
    <link rel="stylesheet" href="components/app.css" />
    <link rel="stylesheet" href="components/editor/editor.css" />
    <link rel="stylesheet" href="components/editor/menu/editor-menu.css" />
    <link rel="stylesheet" href="components/editor/url-input/editor-url-input.css" />
    <link rel="stylesheet" href="components/preview/preview.css" />
    <link rel="stylesheet" href="components/preview/diagram/preview-diagram.css" />
    <link rel="stylesheet" href="components/preview/menu/preview-menu.css" />
    <link rel="stylesheet" href="components/preview/paginator/paginator.css" />
    <link rel="stylesheet" href="components/modals/modals.css" />
    <link rel="stylesheet" href="components/modals/diagram-export/diagram-export.css" />
    <link rel="stylesheet" href="components/modals/diagram-import/diagram-import.css" />
    <link rel="stylesheet" href="components/modals/settings/settings.css" />
    <link rel="stylesheet" href="components/preview/menu/menuStyle.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css">
    
    <!-- Scripts base -->
    <script src="js/app-init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/plantuml-base.js"></script>
    <script src="js/plantuml-encoder.js"></script>
    
    <!-- Utilities -->
    <script src="js/utilities/dom-helpers.js"></script>
    <script src="js/utilities/os-helpers.js"></script>
    <script src="js/utilities/theme-helpers.js"></script>
    <script src="js/utilities/url-helpers.js"></script>
    
    <!-- Communication -->
    <script src="js/communication/browser.js"></script>
    <script src="js/communication/server.js"></script>
    
    <!-- Config -->
    <script src="js/config/config.js"></script>
    
    <!-- Components -->
    <script src="components/editor/url-input/editor-url-input.js"></script>
    <script src="components/editor/menu/editor-menu.js"></script>
    <script src="components/editor/editor.js"></script>
    <script src="components/preview/diagram/preview-diagram.js"></script>
    <script src="components/preview/paginator/paginator.js"></script>
    <script src="components/preview/preview.js"></script>
    <script src="components/modals/diagram-export/diagram-export.js"></script>
    <script src="components/modals/diagram-import/diagram-import.js"></script>
    <script src="components/modals/settings/settings.js"></script>
    <script src="components/modals/modals.js"></script>
    <script src="components/app.js"></script>
    
    <!-- PlantUML Language Features (este sí puede quedar minificado) -->
    <script src="min/plantuml-language.min.js"></script>
    
    <!-- Monaco Editor desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.js"></script>
    
    <title>PlantUML - AlvaritoUML</title>
</head>
<body>
  <div class="app flex-rows">
    <!-- Header -->
    <div class="header">
      <h1>AlvaritoUML</h1>
      <p>Un fork sin publicidad de <a href="https://plantuml.com">PlantUML</a></p>
    </div>

    <!-- Main content: Editor + Preview -->
    <div class="main flex-main flex-columns">
      
      <!-- Editor -->
      <div id="editor-main-container" class="editor flex-main flex-rows">
        <!-- URL Input Bar -->
        <div>
          <div class="btn-input">
            <input id="url" type="text" name="url" value="https://www.plantuml.com/plantuml/png/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000" />
            <input id="url-copy-btn" type="image" alt="copy" src="assets/actions/copy.svg" tabindex="-1" />
          </div>
        </div>
        
        <!-- Monaco Editor -->
          <div class="flex-main monaco-editor-container">
            <textarea id="initCode" name="initCode" style="display: none;">@startuml&#10;Bob -&gt; Alice : hello&#10;@enduml</textarea>
            <div id="monaco-editor"></div>
            
    
            
          </div>
      </div>
      
      <!-- Preview -->
      <div id="previewer-main-container" class="previewer flex-main">
        <div class="previewer-container flex-rows">
          
          <!-- Preview Menu -->
          <div class="preview-menu">
            <div class="diagram-links flex-columns">
                <button class="pdfBtn" id="pdfButton">Descargar PDF</button>
                <button class="pdfBtn" id="refreshButton">Actualizar Diagrama</button>
              
              <!-- Botón de Google Drive -->
              <div>
                <button class="gsi-material-button" id="google-auth-button" onclick="handleGoogleAuthClick()">
                  <div class="gsi-material-button-state"></div>
                  <div class="gsi-material-button-content-wrapper">
                    <div class="gsi-material-button-icon">
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                        <path fill="none" d="M0 0h48v48H0z"></path>
                      </svg>
                    </div>
                    <span class="gsi-material-button-contents">Sign in with Google</span>
                    <span style="display: none;">Sign in with Google</span>
                  </div>
                </button>
                
                <!-- Dropdown de archivos -->
                <div class="sec-center" id="files-dropdown" style="display: none; margin-top: 10px;">
                  <input class="dropdown" type="checkbox" id="dropdown" name="dropdown"/>
                  <label class="for-dropdown" for="dropdown">
                    <span id="dropdown-title">Seleccionar proyecto</span> 
                    <i class="uil uil-arrow-down"></i>
                  </label>
                  <div class="section-dropdown" id="section-dropdown">
                    <!-- Los archivos se cargarán dinámicamente aquí -->
                  </div>
                </div>
              </div>
              
              <a id="map-diagram-link" class="diagram-link" data-img-type="map" href="https://www.plantuml.com/plantuml/map/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000" title="View diagram as Map Data" style="display: none;">
                <img src="assets/file-types/map.svg" alt="MAP" />
              </a>
              
            
            </div>
          </div>
          
          <div class="hr"></div>
          
          <!-- Paginator -->
          <div id="paginator" data-number-of-diagram-pages="1" style="display: none;"></div>
          
          <!-- Diagram Display -->
          <div class="previewer-main flex-main">
            <div id="diagram" class="diagram">
              <div>
                <img id="diagram-png" src="https://www.plantuml.com/plantuml/png/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000" alt="PlantUML diagram" usemap="#plantuml_map" />
                <map id="plantuml_map" name="plantuml_map"></map>
                <svg id="diagram-svg" style="display: none;"></svg>
                <pre id="diagram-txt" style="display: none;"></pre>
                <object id="diagram-pdf" data="" type="application/pdf" width="100%" height="100%" style="display: none;">
                  <p>Unable to display PDF file.</p>
                </object>
              </div>
            </div>
          </div>
          
          <!-- Settings Modal -->
          <div id="settings" class="modal" style="display: none;" tabindex="-1">
            <div class="modal-content flex-rows">
              <div class="modal-header">
                <h2>Settings</h2>
                <div class="hr"></div>
              </div>
              <div class="modal-main flex-main">
                <div class="label-input-pair flex-columns">
                  <label for="theme">Theme:</label>
                  <select class="flex-main" id="theme" name="theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                </div>
                <div class="label-input-pair flex-columns">
                  <label for="diagramPreviewType">Diagram Preview Type:</label>
                  <select class="flex-main" id="diagramPreviewType" name="diagramPreviewType">
                    <option value="png">PNG</option>
                    <option value="svg">SVG</option>
                    <option value="txt">ASCII Art</option>
                    <option value="pdf">PDF</option>
                  </select>
                </div>
                <div class="label-input-pair flex-columns">
                  <label for="editorWatcherTimeout">Editor Watcher Timeout:</label>
                  <input class="flex-main" id="editorWatcherTimeout" type="number" pattern="[1-9]+[0-9]*" value="" />
                </div>
                <div class="label-input-pair flex-main">
                  <label for="editorCreateOptions">Monaco Editor Create Options:</label>
                  <br />
                  <div id="settings-monaco-editor"></div>
                </div>
              </div>
              <div class="modal-footer">
                <input id="settings-ok-btn" class="ok" type="button" value="Save" />
                <input class="cancel" type="button" value="Cancel" onclick="closeModal('settings');" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <p>PlantUML - AlvaritoUML | Powered by <a href="https://www.plantuml.com/plantuml">PlantUML Official Server</a></p>
    </div>
    
    <!-- Import Modal -->
    <div id="diagram-import" class="modal" style="display: none;" tabindex="-1">
      <div class="modal-content flex-rows">
        <div class="modal-header">
          <h2>Import Diagram</h2>
          <div class="hr"></div>
        </div>
        <div class="modal-main flex-main">
          <input id="diagram-import-input" type="file" name="diagram" />
          <p id="diagram-import-error-message" class="error-message"></p>
        </div>
        <div class="modal-footer">
          <input id="diagram-import-ok-btn" class="ok" type="button" value="Import" disabled />
          <input id="diagram-import-cancel-btn" class="cancel" type="button" value="Cancel" onclick="closeModal('diagram-import');" />
        </div>
      </div>
    </div>
    
    <!-- Export Modal -->
    <div id="diagram-export" class="modal" style="display: none;" tabindex="-1">
      <div class="modal-content flex-rows">
        <div class="modal-header">
          <h2>Export Diagram</h2>
          <div class="hr"></div>
        </div>
        <div class="modal-main flex-main">
          <div class="label-input-pair flex-columns">
            <label for="download-name">Diagram name:</label>
            <input class="flex-main" id="download-name" value="diagram.puml" />
          </div>
          <div class="label-input-pair flex-columns">
            <label for="download-type">Diagram type:</label>
            <select class="flex-main" id="download-type" name="download-type">
              <option value="txt">ASCII Art</option>
              <option value="base64">Base64</option>
              <option value="eps">EPS</option>
              <option value="epstext">EPS Text</option>
              <option value="map">MAP</option>
              <option value="pdf">PDF</option>
              <option value="code" selected>PlantUML source code</option>
              <option value="png">PNG</option>
              <option value="svg">SVG</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <input id="diagram-export-ok-btn" class="ok" type="button" value="Export" />
          <input class="cancel" type="button" value="Cancel" onclick="closeModal('diagram-export')" />
        </div>
      </div>
    </div>
  </div>
  
  <!-- Google Drive Integration -->
  <script>
    // Cargar configuración de Google Drive de forma secuencial
    (function() {
      // Intentar cargar config de desarrollo
      const devScript = document.createElement('script');
      devScript.src = 'components/preview/menu/google-drive-config.js';
      
      devScript.onerror = function() {
        console.log('⚠️ google-drive-config.js no encontrado, cargando configuración de producción...');
        
        // Si falla, cargar config de producción
        const prodScript = document.createElement('script');
        prodScript.src = 'components/preview/menu/google-drive-config.prod.js';
        
        prodScript.onload = function() {
          console.log('✅ Configuración de producción cargada');
          loadGoogleDriveIntegration();
        };
        
        prodScript.onerror = function() {
          console.error('❌ No se pudo cargar ninguna configuración de Google Drive');
        };
        
        document.head.appendChild(prodScript);
      };
      
      devScript.onload = function() {
        loadGoogleDriveIntegration();
      };
      
      document.head.appendChild(devScript);
      
      // Función para cargar la integración solo cuando el config esté listo
      function loadGoogleDriveIntegration() {
        const integrationScript = document.createElement('script');
        integrationScript.src = 'components/preview/menu/google-drive-integration.js';
        integrationScript.onload = function() {
          // Cargar Google APIs después de la integración
          const gapiScript = document.createElement('script');
          gapiScript.src = 'https://apis.google.com/js/api.js';
          gapiScript.async = true;
          gapiScript.defer = true;
          gapiScript.onload = function() {
            if (typeof gapiLoaded === 'function') gapiLoaded();
          };
          document.head.appendChild(gapiScript);
          
          const gsiScript = document.createElement('script');
          gsiScript.src = 'https://accounts.google.com/gsi/client';
          gsiScript.async = true;
          gsiScript.defer = true;
          gsiScript.onload = function() {
            if (typeof gisLoaded === 'function') gisLoaded();
          };
          document.head.appendChild(gsiScript);
        };
        document.head.appendChild(integrationScript);
      }
    })();
  </script>
</body>
</html>
