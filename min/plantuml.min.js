'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,c){if(!c||null!=a){c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]}};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.getRestArguments=function(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};
function initApp(){var a,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return b=null==(a=(new URL(window.location.href)).searchParams.get("view"))?void 0:a.toLowerCase(),c.yield(initEditor(b),2);if(3!=c.nextAddress){var d=analyseUrl(window.location.href),e,f=null==(e=document.editor)?void 0:e.getValue(),g;document.appData=Object.assign({},null==(g=window.opener)?void 0:g.document.appData);0===Object.keys(document.appData).length&&(document.appData={encodedDiagram:d.encodedDiagram,
index:d.index,numberOfDiagramPages:f?getNumberOfDiagramPagesFromCode(f):1});initTheme();initAppCommunication();return c.yield(initPreview(b),3)}initModals(b);document.editor&&(document.editor.focus(),"SyfFKj2rKt3CoKnELR1Io4ZDoSa70000"==document.appData.encodedDiagram&&document.editor.setSelection({startLineNumber:2,endLineNumber:2,startColumn:1,endColumn:21}));document.appConfig.autoRefreshState="complete";c.jumpToEnd()})}window.onload=initApp;
var $jscomp$destructuring$var0=function(){return{setEditorValue:function(a,b,c){c=void 0===c?{}:c;var d=void 0===c.forceMoveMarkers?void 0:c.forceMoveMarkers;(void 0===c.suppressEditorChangedMessage?0:c.suppressEditorChangedMessage)&&a===document.editor&&suppressNextMessage("editor");a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:b,forceMoveMarkers:d}])},initEditor:function(a){function b(){return new Promise(function(g,n){require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs"}});
require(["vs/editor/editor.main"],g)})}function c(){function g(p,l,k){function q(){document.appData||(document.appData={encodedDiagram:void 0,index:void 0,numberOfDiagramPages:1});document.appConfig||(document.appConfig={diagramPreviewType:"png",editorWatcherTimeout:500,autoRefreshState:"idle"});document.appConfig.autoRefreshState="started";var t=getNumberOfDiagramPagesFromCode(p),u=document.appData.index;void 0===u||1===t?u=void 0:u>=t&&(u=t-1);try{var v=encodePlantUML(p);console.log("\u2705 Diagram encoded locally:",v.substring(0,20)+"...");document.appData.encodedDiagram=v;document.appData.numberOfDiagramPages=t;document.appData.index=u;sendMessage({sender:l,data:{encodedDiagram:v,numberOfDiagramPages:t,index:u},synchronize:!0})}catch(w){console.error("\u274c Error encoding diagram:",w)}}k=void 0===k?!0:k;var r=function(){return function(){var t=document.editor.getModel();n=n||new PlantUmlLanguageFeatures;
n.validateCode(t).then(function(u){return monaco.editor.setModelMarkers(t,"plantuml",u)})}}();l&&k&&q();r()}var n,m=monaco.editor.createModel(function(){var p=document.getElementById("initCode"),l=p.value;p.remove();return l}(),"apex",monaco.Uri.parse("inmemory://plantuml")),h=0;m.onDidChangeContent(function(){var p=m.getValue(),l=document.getElementById("url").value;console.log("Texto ingresado:",p);console.log("URL actual: ",l);"function"===typeof actualizarArchivoSeleccionado&&window.selectedFileId&&
(clearTimeout(window.driveUpdateTimer),window.driveUpdateTimer=setTimeout(function(){actualizarArchivoSeleccionado(l).then(function(){return console.log("Archivo actualizado en Google Drive con URL:",l)}).catch(function(k){return console.error("Error actualizando en Drive:",k)})},2E3));clearTimeout(h);document.appConfig.autoRefreshState="waiting";h=setTimeout(function(){return g(m.getValue(),"editor")},document.appConfig.editorWatcherTimeout)});return m}function d(){return{get:function(){},getBoolean:function(g){return"expandSuggestionDocs"===
g},getNumber:function(){return 0},remove:function(){},store:function(){},onWillSaveState:function(){},onDidChangeStorage:function(){},onDidChangeValue:function(){}}}var e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(b(),2);"previewer"!==a&&(e=c(),f=d(),document.editor=monaco.editor.create(document.getElementById("monaco-editor"),Object.assign({},{model:e},document.appConfig.editorCreateOptions),{storageService:f}),document.addEventListener("resize",
function(){return document.editor.layout()}),initEditorUrlInput(),initEditorMenu());g.jumpToEnd()})}}}(),setEditorValue=$jscomp$destructuring$var0.setEditorValue,initEditor=$jscomp$destructuring$var0.initEditor;
function initEditorMenu(){document.getElementById("menu-item-editor-code-copy").addEventListener("click",function(){var a=document.editor.getModel().getFullModelRange();document.editor.focus();document.editor.setSelection(a);a=document.editor.getValue();var b;null==(b=navigator.clipboard)||b.writeText(a).catch(function(){})})}
var $jscomp$destructuring$var3=function(){function a(b,c,d){var e=void 0===c?{}:c;c=void 0===e.encodedDiagram?void 0:e.encodedDiagram;e=void 0===e.index?void 0:e.index;d=void 0===d?{}:d;if(b||c)(void 0===d.suppressEditorChangedMessage?0:d.suppressEditorChangedMessage)&&suppressNextMessage("url"),document.getElementById("url").value=b?b:resolvePath(buildUrl("png",c,e))}return{setUrlValue:a,initEditorUrlInput:function(){var b=document.getElementById("url");a(resolvePath(b.value));b.addEventListener("change",
function(c){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return document.appConfig.autoRefreshState="started",c.target.title=c.target.value,d=analyseUrl(c.target.value),f.yield(decodePlantUML(d.encodedDiagram),2);e=f.yieldResult;setEditorValue(document.editor,e,{suppressEditorChangedMessage:!0});sendMessage({sender:"url",data:{encodedDiagram:d.encodedDiagram,index:d.index},synchronize:!0});f.jumpToEnd()})});document.getElementById("url-copy-btn").addEventListener("click",
function(){b.focus();b.select();var c;null==(c=navigator.clipboard)||c.writeText(b.value).catch(function(){})})}}}(),setUrlValue=$jscomp$destructuring$var3.setUrlValue,initEditorUrlInput=$jscomp$destructuring$var3.initEditorUrlInput;
function initDiagramExport(){function a(){setVisibility(document.getElementById("diagram-export"),!0,!0);var f=document.editor.getValue();f=Array.from(f.matchAll(/^\s*@start[a-zA-Z]*\s+([a-zA-Z-_\u00c3\u00a4\u00c3\u00b6\u00c3\u00bc\u00c3\u201e\u00c3\u2013\u00c3\u0153\u00c3\u0178 ]+)\s*$/gm),function(g){return g[1]})[0]||"diagram";d.value=f+".puml";e.value="code";d.focus()}function b(f){var g=f.lastIndexOf(".");return 1>g?{name:f,ext:null}:g===f.length-1?{name:f.slice(0,-1),ext:null}:{name:f.substring(0,
g),ext:f.substring(g+1)}}function c(f){if(!f)return f;f=f.toLowerCase();switch(f){case "puml":case "plantuml":case "code":return"code";case "ascii":return"txt";default:return f}}var d=document.getElementById("download-name"),e=document.getElementById("download-type");registerModalListener("diagram-export",a);d.addEventListener("change",function(f){f=b(f.target.value).ext;if(f=c(f))e.value=f});e.addEventListener("change",function(f){f=f.target.value;a:switch(f){case "epstext":f="eps";break a;case "code":f=
"puml"}var g=b(d.value).name;d.value=g+"."+f});document.getElementById("diagram-export-ok-btn").addEventListener("click",function(){var f=d.value,g=e.value,n=document.createElement("a");n.download=f;"code"===g?(f=document.editor.getValue(),n.href="data:,"+encodeURIComponent(f)):n.href=void 0!==document.appData.index?g+"/"+document.appData.index+"/"+document.appData.encodedDiagram:g+"/"+document.appData.encodedDiagram;n.click()});window.addEventListener("keydown",function(f){"s"===f.key&&(isMac?f.metaKey:
f.ctrlKey)&&(f.preventDefault(),isModalOpen("diagram-export")||a())},!1)}
function initDiagramImport(){function a(h){h=void 0===h?!0:h;setVisibility(f,!0,!0);f.dataset.isOpenManually=h.toString();g.value="";c(g)}function b(){g.value="";c(g);f.removeAttribute("data-is-open-manually");setVisibility(f,!1)}function c(h){m.innerText="";var p;n.disabled=1>(null==(p=h.files)?void 0:p.length)}function d(h){function p(k){var q=k.name,r=k.type;k=["plain","text","plantuml","puml"];if(0<k.filter(function(u){return-1!==r.toLowerCase().indexOf(u)}).length)return!0;if(-1===q.indexOf("."))return!1;
var t=q.substring(q.lastIndexOf(".")+1).toLowerCase();k=["txt","puml","plantuml"];return 0<k.filter(function(u){return t===u}).length}var l=function(k){var q=k.name,r=k.type;k=["png","svg"];var t=k.filter(function(v){return-1!==r.toLowerCase().indexOf(v)})[0];if(t)return t;if(-1!==q.indexOf(".")){var u=q.substring(q.lastIndexOf(".")+1).toLowerCase();return k.filter(function(v){return u===v})[0]}}(h);h=void 0===l?p(h):!1;l||h||(m.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.");
return{type:l,isDiagramCode:h,valid:l||h}}function e(h,p){function l(k){var q=new FormData;q.append("diagram",k,k.name);return makeRequest("POST","metadata",{data:q,responseType:"json",headers:{Accept:"application/json"}})}f.classList.add("wait");return(new Promise(function(k,q){if(p.type)l(h).then(function(t){setEditorValue(document.editor,t.decoded);k()},function(t){t=t.response;m.innerText=t.message||t;q()});else if(p.isDiagramCode){var r=new FileReader;r.onload=function(t){setEditorValue(document.editor,
t.target.result)};r.readAsText(h);k()}else m.innerText="File not supported. Only PNG and SVG diagram images as well as PlantUML code text files are supported.",q()})).then(function(){return b()},function(){}).finally(function(){return f.classList.remove("wait")})}var f=document.getElementById("diagram-import"),g=document.getElementById("diagram-import-input"),n=document.getElementById("diagram-import-ok-btn"),m=document.getElementById("diagram-import-error-message");window.addEventListener("dragenter",
function(h){h.stopPropagation();h.preventDefault();isVisible(f)||a(!1)},!1);g.addEventListener("dragenter",function(h){return h.target.classList.add("drop-able")},!1);g.addEventListener("dragover",function(h){h.stopPropagation();h.preventDefault();null!==h.dataTransfer&&(h.dataTransfer.dropEffect="copy")},!1);g.addEventListener("dragexit",function(h){return h.target.classList.remove("drop-able")},!1);g.addEventListener("drop",function(h){function p(){h.stopPropagation();h.preventDefault()}var l=h.dataTransfer.files||
h.target.files;if(!l||1>l.length)return p();l=l[0];var k=d(l);if(!k.valid)return p();"true"!==f.dataset.isOpenManually&&(p(),e(l,k))},!1);g.addEventListener("change",function(h){return c(h.target)});n.addEventListener("click",function(){var h=g.files[0];e(h,d(h))});registerModalListener("diagram-import",a,b)}
var $jscomp$destructuring$var16=function(){var a={};return{registerModalListener:function(b,c,d){a[b]={fnOpen:c,fnClose:d}},openModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),d,e=null==(d=a[b])?void 0:d.fnOpen;e?e.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),!0,!0)},closeModal:function(b){var c=$jscomp.getRestArguments.apply(1,arguments),d,e=null==(d=a[b])?void 0:d.fnClose;e?e.apply(null,$jscomp.arrayFromIterable(c)):setVisibility(document.getElementById(b),
!1)}}}(),registerModalListener=$jscomp$destructuring$var16.registerModalListener,openModal=$jscomp$destructuring$var16.openModal,closeModal=$jscomp$destructuring$var16.closeModal;
function initModals(a){function b(c){"Escape"===c.key||"Esc"===c.key?(c.preventDefault(),closeModal(c.target.closest(".modal").id)):"Enter"===c.key&&(c.preventDefault(),(c=c.target.closest(".modal").querySelector('input.ok[type\x3d"button"]'))&&!c.disabled&&c.click())}document.querySelectorAll(".modal").forEach(function(c){c.addEventListener("keydown",b,!1)});initSettings();"previewer"!==a&&(initDiagramExport(),initDiagramImport())}
function isModalOpen(a){return isVisible(document.getElementById(a))}function closeAllModals(){document.querySelectorAll(".modal").forEach(function(a){return closeModal(a.id)})}
function initSettings(){function a(){setVisibility(document.getElementById("settings"),!0,!0);b.value=document.appConfig.theme;c.value=document.appConfig.diagramPreviewType;d.value=document.appConfig.editorWatcherTimeout;setEditorValue(document.settingsEditor,JSON.stringify(document.appConfig.editorCreateOptions,null,"  "))}var b=document.getElementById("theme"),c=document.getElementById("diagramPreviewType"),d=document.getElementById("editorWatcherTimeout");document.settingsEditor=monaco.editor.create(document.getElementById("settings-monaco-editor"),
Object.assign({},{language:"json"},document.appConfig.editorCreateOptions));b.addEventListener("change",function(e){e=e.target.value;var f=document.settingsEditor.getValue();setEditorValue(document.settingsEditor,f.replace(new RegExp('("theme"\\s*:\\s*)"'+("dark"===e?"vs":"vs-dark")+'"',"gm"),'$1"'+("dark"===e?"vs-dark":"vs")+'"'))});document.getElementById("settings-ok-btn").addEventListener("click",function(){var e=Object.assign({},document.appConfig);e.theme=b.value;e.editorWatcherTimeout=d.value;
e.diagramPreviewType=c.value;e.editorCreateOptions=JSON.parse(document.settingsEditor.getValue());updateConfig(e);closeModal("settings")});window.addEventListener("keydown",function(e){","===e.key&&(isMac?e.metaKey:e.ctrlKey)&&(e.preventDefault(),isModalOpen("settings")||a())},!1);registerModalListener("settings",a)}
function initializeDiagram(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if("png"!==document.appConfig.diagramPreviewType)return a.return(setDiagram(document.appConfig.diagramPreviewType,document.appData.encodedDiagram,document.appData.index));a.jumpToEnd()})}
function setDiagram(a,b,c){function d(k,q,r){return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){return t.return(makeRequest("GET",buildUrl(k,q,r)))})}var e,f,g,n,m,h,p,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:e=document.getElementById("diagram");f=document.getElementById("diagram-png");g=document.getElementById("diagram-txt");n=document.getElementById("diagram-pdf");k.setCatchFinallyBlocks(2);if("png"===a)return f.src=buildUrl("png",
b,c),k.yield(d("map",b,c),11);if("svg"===a)return k.yield(d("svg",b,c),10);if("txt"!==a){if("pdf"===a)n.data=buildUrl("pdf",b,c);else return m="unknown diagram type: "+a,(console.error||console.log)(m),k.return(Promise.reject(m));k.jumpTo(5);break}h=g;return k.yield(d("txt",b,c),9);case 9:h.innerHTML=k.yieldResult;k.jumpTo(5);break;case 10:p=k.yieldResult;var q=document.getElementById("diagram-svg"),r=document.createElement("div");r.innerHTML=p;r=r.querySelector("svg");r.id="diagram-svg";r.classList=
q.classList;r.style.cssText=q.style.cssText;q.parentNode.replaceChild(r,q);k.jumpTo(5);break;case 11:if(l=k.yieldResult,q=document.getElementById("plantuml_map"),r=document.getElementById("map-diagram-link"),l){var t=document.createElement("div");t.innerHTML=l;q.parentNode.replaceChild(t.firstChild,q);setVisibility(r,!0)}else removeChildren(q),setVisibility(r,!1);case 5:q=document.getElementById("plantuml_map");r=document.getElementById("diagram-svg");e.setAttribute("data-diagram-type",a);setVisibility(f,
"png"===a);setVisibility(q,"png"===a);setVisibility(r,"svg"===a);setVisibility(g,"txt"===a);setVisibility(n,"pdf"===a);k.leaveTryBlock(0);break;case 2:k.enterCatchBlock(),k.jumpToEnd()}})}var GOOGLE_DRIVE_CONFIG={CLIENT_ID:"TU_CLIENT_ID_AQUI.apps.googleusercontent.com",API_KEY:"TU_API_KEY_AQUI",DISCOVERY_DOC:"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",SCOPES:"https://www.googleapis.com/auth/drive"};
if("undefined"===typeof GOOGLE_DRIVE_CONFIG)throw console.error("\u00e2\u009d\u0152 GOOGLE_DRIVE_CONFIG no est\u00c3\u00a1 definido!"),console.error("Aseg\u00c3\u00barate de:"),console.error("1. Tener el archivo google-drive-config.js en desarrollo, O"),console.error("2. Configurar GOOGLE_CLIENT_ID y GOOGLE_API_KEY en variables de entorno para producci\u00c3\u00b3n"),Error("GOOGLE_DRIVE_CONFIG no est\u00c3\u00a1 definido");
var CLIENT_ID=GOOGLE_DRIVE_CONFIG.CLIENT_ID,API_KEY=GOOGLE_DRIVE_CONFIG.API_KEY,DISCOVERY_DOC=GOOGLE_DRIVE_CONFIG.DISCOVERY_DOC,SCOPES=GOOGLE_DRIVE_CONFIG.SCOPES;console.log("\u00e2\u0153\u2026 Google Drive configurado correctamente");console.log("   Client ID:",GOOGLE_DRIVE_CONFIG.CLIENT_ID?GOOGLE_DRIVE_CONFIG.CLIENT_ID.substring(0,20)+"...":"NO DEFINIDO");console.log("   API Key:",GOOGLE_DRIVE_CONFIG.API_KEY?GOOGLE_DRIVE_CONFIG.API_KEY.substring(0,10)+"...":"NO DEFINIDO");
var tokenClient,gapiInited=!1,gisInited=!1,workFolderId=null;window.selectedFileId=null;function gapiLoaded(){gapi.load("client",initializeGapiClient)}function initializeGapiClient(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if(1==a.nextAddress)return a.yield(gapi.client.init({apiKey:GOOGLE_DRIVE_CONFIG.API_KEY,discoveryDocs:[GOOGLE_DRIVE_CONFIG.DISCOVERY_DOC]}),2);gapiInited=!0;maybeEnableButtons();checkExistingSession();a.jumpToEnd()})}
function gisLoaded(){tokenClient=google.accounts.oauth2.initTokenClient({client_id:GOOGLE_DRIVE_CONFIG.CLIENT_ID,scope:GOOGLE_DRIVE_CONFIG.SCOPES,callback:"",prompt:""});gisInited=!0;maybeEnableButtons()}function maybeEnableButtons(){if(gapiInited&&gisInited){var a=document.getElementById("google-auth-button");a&&(a.disabled=!1)}}
function checkExistingSession(){var a,b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:a=localStorage.getItem("google_access_token");b=localStorage.getItem("google_token_expiry");if(!a||!b){e.jumpTo(0);break}c=Date.now();d=parseInt(b);if(!(c<d)){console.log("Token guardado expirado, limpiando...");localStorage.removeItem("google_access_token");localStorage.removeItem("google_token_expiry");e.jumpTo(0);break}console.log("Token guardado encontrado y v\u00c3\u00a1lido, restaurando sesi\u00c3\u00b3n...");
gapi.client.setToken({access_token:a});e.setCatchFinallyBlocks(4);return e.yield(gapi.client.drive.files.list({pageSize:1,fields:"files(id)"}),6);case 6:return console.log("Sesi\u00c3\u00b3n restaurada exitosamente"),e.yield(onAuthSuccess(),7);case 7:return e.return();case 4:e.enterCatchBlock(),console.log("Token guardado inv\u00c3\u00a1lido, limpiando..."),localStorage.removeItem("google_access_token"),localStorage.removeItem("google_token_expiry"),gapi.client.setToken(null),e.jumpToEnd()}})}
function handleGoogleAuthClick(){tokenClient.callback=function(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(void 0!==a.error)return console.error("Error en autenticaci\u00c3\u00b3n:",a),c.return();a.access_token&&(b=Date.now()+36E5,localStorage.setItem("google_access_token",a.access_token),localStorage.setItem("google_token_expiry",b.toString()),console.log("Token guardado en localStorage"));return c.yield(onAuthSuccess(),0)})};null===gapi.client.getToken()?tokenClient.requestAccessToken({prompt:"consent"}):
tokenClient.requestAccessToken({prompt:""})}
function onAuthSuccess(){var a,b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d.yield(crearCarpetaTrabajo(),4);case 4:return workFolderId=d.yieldResult,console.log("Carpeta de trabajo ID:",workFolderId),a=document.getElementById("google-auth-button"),b=document.getElementById("files-dropdown"),a&&(a.style.display="none"),b&&(b.style.display="block"),d.yield(cargarArchivosEnDropdown(workFolderId),5);case 5:d.leaveTryBlock(0);
break;case 2:c=d.enterCatchBlock(),console.error("Error en onAuthSuccess:",c),d.jumpToEnd()}})}
function crearCarpetaTrabajo(){var a,b,c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.yield(gapi.client.drive.files.list({q:"mimeType\x3d'application/vnd.google-apps.folder' and name contains 'plantUMLsaves' and trashed\x3dfalse",fields:"files(id, name, parents)"}),2);case 2:a=g.yieldResult;b=a.result&&a.result.files||[];if(0<b.length)return console.log("Carpeta existente encontrada:",b[0]),g.return(b[0].id);g.setCatchFinallyBlocks(3);
c={name:"plantUMLsaves",mimeType:"application/vnd.google-apps.folder"};return g.yield(gapi.client.drive.files.create({resource:c,fields:"id"}),5);case 5:return d=g.yieldResult,e=d.result&&d.result.id,console.log("Carpeta creada con id:",e),g.return(e);case 3:throw f=g.enterCatchBlock(),console.error("Error al crear la carpeta de trabajo",f),f;}})}
function cargarArchivosEnDropdown(a){var b,c,d,e,f,g,n,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return h.setCatchFinallyBlocks(2),console.log("Cargando archivos de la carpeta:",a),h.yield(gapi.client.drive.files.list({q:"'"+a+"' in parents and trashed\x3dfalse and mimeType!\x3d'application/vnd.google-apps.folder'",fields:"files(id, name, size, mimeType)",supportsAllDrives:!0,pageSize:100}),4);if(2!=h.nextAddress){b=h.yieldResult;c=b.result&&b.result.files||
[];d=c.filter(function(p){return 0<(parseInt(p.size)||0)});console.log("Encontrados "+d.length+" archivos no vac\u00c3\u00ados");e=document.getElementById("section-dropdown");f=document.getElementById("dropdown-title");if(!e)return console.error("No se encontr\u00c3\u00b3 el contenedor del dropdown"),h.return();e.innerHTML="";d.forEach(function(p){var l=document.createElement("a");l.href="#";l.textContent=p.name;l.dataset.fileId=p.id;l.dataset.fileName=p.name;l.addEventListener("click",function(k){return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){k.preventDefault();
f.textContent=p.name;document.getElementById("dropdown").checked=!1;console.log("Archivo seleccionado:",p.name,"ID:",p.id);window.selectedFileId=p.id;return q.yield(cargarArchivoEnEditor(p.id,p.name),0)})});e.appendChild(l)});g=document.createElement("a");g.href="#";g.textContent="+ Crear nuevo archivo";g.style.fontWeight="bold";g.style.borderTop="1px solid #333";g.style.marginTop="5px";g.style.paddingTop="10px";g.addEventListener("click",function(p){return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){p.preventDefault();
document.getElementById("dropdown").checked=!1;return l.yield(crearNuevoArchivo(),0)})});e.appendChild(g);0===d.length&&(n=document.createElement("a"),n.href="#",n.textContent="No hay archivos",n.style.pointerEvents="none",n.style.opacity="0.5",e.insertBefore(n,g));return h.leaveTryBlock(0)}m=h.enterCatchBlock();console.error("Error cargando archivos en dropdown:",m);h.jumpToEnd()})}
function cargarArchivoEnEditor(a,b){var c,d,e,f,g,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(1==m.nextAddress)return m.setCatchFinallyBlocks(2),console.log("Cargando archivo en editor: "+b),m.yield(gapi.client.drive.files.get({fileId:a,alt:"media",supportsAllDrives:!0}),4);if(2!=m.nextAddress){c=m.yieldResult;d=c.body;console.log("Contenido del archivo cargado (enlace):",d.substring(0,200));if(e=document.getElementById("url"))e.value=d,console.log("Contenido cargado en el campo URL"),
f=new Event("input",{bubbles:!0}),e.dispatchEvent(f),g=new Event("change",{bubbles:!0}),e.dispatchEvent(g),console.log("Vista previa actualizada autom\u00c3\u00a1ticamente");return m.return(d)}n=m.enterCatchBlock();console.error("Error cargando archivo en editor:",n);throw n;})}
function crearNuevoArchivo(){var a,b,c,d,e,f,g,n,m,h,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:l.setCatchFinallyBlocks(2);a=prompt("Ingrese el nombre del archivo:","nuevo-diagrama.puml");if(!a)return console.log("Creaci\u00c3\u00b3n de archivo cancelada"),l.return();b="";(c=document.getElementById("url"))&&c.value&&(b=c.value);b&&""!==b.trim()||document.editor&&(b=document.editor.getValue());console.log("Creando nuevo archivo:",a);console.log("Contenido inicial:",
b.substring(0,100));d=a.trim();e=/\.[^./\\]+$/.test(d)?d:d+".puml";f={name:e,mimeType:"text/plain",parents:[workFolderId]};g="\r\n---------314159265358979323846\r\nContent-Type: application/json; charset\x3dUTF-8\r\n\r\n"+JSON.stringify(f)+"\r\n---------314159265358979323846\r\nContent-Type: text/plain\r\n\r\n"+b+"\r\n---------314159265358979323846--";n=gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart",supportsAllDrives:!0,fields:"id, name, parents"},
headers:{"Content-Type":'multipart/related; boundary\x3d"-------314159265358979323846"'},body:g});return l.yield(n,4);case 4:return m=l.yieldResult,console.log("Archivo creado:",m.result),window.selectedFileId=m.result.id,l.yield(cargarArchivosEnDropdown(workFolderId),5);case 5:if(h=document.getElementById("dropdown-title"))h.textContent=e;l.leaveTryBlock(0);break;case 2:p=l.enterCatchBlock(),console.error("Error creando nuevo archivo:",p),alert("Error al crear el archivo: "+(p.message||p)),l.jumpToEnd()}})}
function actualizarArchivoSeleccionado(a){var b,c,d,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress){if(!window.selectedFileId)return console.log("No hay archivo seleccionado para actualizar"),g.return();g.setCatchFinallyBlocks(2);console.log("Actualizando archivo ID: "+window.selectedFileId);b={mimeType:"text/plain"};c="\r\n---------314159265358979323846\r\nContent-Type: application/json; charset\x3dUTF-8\r\n\r\n"+JSON.stringify(b)+"\r\n---------314159265358979323846\r\nContent-Type: text/plain\r\n\r\n"+
a+"\r\n---------314159265358979323846--";d=gapi.client.request({path:"/upload/drive/v3/files/"+window.selectedFileId,method:"PATCH",params:{uploadType:"multipart",supportsAllDrives:!0,fields:"id, name, modifiedTime"},headers:{"Content-Type":'multipart/related; boundary\x3d"-------314159265358979323846"'},body:c});return g.yield(d,4)}if(2!=g.nextAddress)return e=g.yieldResult,console.log("Archivo actualizado exitosamente:",e.result),g.return(e.result);f=g.enterCatchBlock();console.error("Error actualizando archivo:",
f);throw f;})}"undefined"!==typeof gapi&&gapiLoaded();window.handleGoogleAuthClick=handleGoogleAuthClick;window.actualizarArchivoSeleccionado=actualizarArchivoSeleccionado;function getNumberOfDiagramPagesFromCode(a){var b;return(null==(b=a.match(/^\s*newpage\s?.*$/gm))?void 0:b.length)+1||1}
function updatePaginatorSelection(){var a=document.getElementById("paginator"),b=document.appData.index;if(void 0===b||a.childNodes.length<=b)for(a=$jscomp.makeIterator(a.childNodes),b=a.next();!b.done;b=a.next())b.value.checked=!1;else a.childNodes[b].checked=!0}
var updatePaginator=function(){function a(b,c){for(;b.childElementCount>c;)b.removeChild(b.lastChild);for(;b.childElementCount<c;){var d=document.createElement("input");d.name="paginator";d.type="radio";d.value=b.childElementCount;d.addEventListener("click",function(e){sendMessage({sender:"paginator",data:{index:e.target.value},synchronize:!0})});b.appendChild(d)}}return function(){var b=document.getElementById("paginator"),c=document.appData.numberOfDiagramPages;1<c?(a(b,c),setVisibility(b,!0)):
setVisibility(b,!1)}}();function initializePaginator(){1<document.appData.numberOfDiagramPages&&(updatePaginator(),updatePaginatorSelection())}
function initPreview(a){function b(){setVisibility(e,!1);setVisibility(f,window.opener);g&&(g.style.width="100%");n&&setVisibility(n,!1)}function c(){setVisibility(e,!0);setVisibility(f,!1);g&&g.style.removeProperty("width");n&&setVisibility(n,!0)}function d(){var m=new URL(window.location.href);m.searchParams.set("view","previewer");if(m=window.open(m,"PlantUML Diagram Previewer","popup"))m.onbeforeunload=c,b()}var e,f,g,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(1==m.nextAddress)return e=
document.getElementById("btn-undock"),f=document.getElementById("btn-dock"),g=document.getElementById("editor-main-container"),n=document.getElementById("previewer-main-container"),e.addEventListener("click",d),m.yield(initializeDiagram(),2);initializePaginator();["previewer","editor"].includes(a)&&b();m.jumpToEnd()})}
var $jscomp$destructuring$var17=function(){var a=function(){var c=[];return{suppressNextMessage:function(d,e){c.push({sender:d,condition:e})},isMessageSuppressed:function(d){for(var e=0;e<c.length;e++){var f=c[e];if(!f.sender||f.sender===d.sender)if(!f.condition||f.condition(d))return c.splice(e,1),!0}return!1}}}(),b=a.isMessageSuppressed;return{sendMessage:function(c){if(!b(c)){(new BroadcastChannel("plantuml-server")).postMessage(c);window.dispatchEvent(new CustomEvent('plantuml-message',{detail:{data:c}}))}},suppressNextMessage:a.suppressNextMessage,initAppCommunication:function(){(new BroadcastChannel("plantuml-server")).onmessage=
function(c){function d(n){var m,h,p,l,k,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return document.appConfig.autoRefreshState="syncing",m=document.appData.encodedDiagram,h=document.appData.index,"url"!==n&&document.getElementById("url")&&setUrlValue(void 0,{encodedDiagram:m,index:h},{suppressEditorChangedMessage:!0}),r.yield(setDiagram(document.appConfig.diagramPreviewType,m,h),2);p=$jscomp.makeIterator(document.getElementsByClassName("diagram-link"));for(l=
p.next();!l.done;l=p.next())k=l.value,k.href=buildUrl(k.dataset.imgType,m,h);q=replaceUrl(window.location.href,m,h).url;history.replaceState(history.stat,document.title,q);document.appConfig.autoRefreshState="complete";r.jumpToEnd()})}var e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(1==n.nextAddress){e=c.data.data;f=c.data.force||!1;if(e&&0!==Object.keys(e).length){var m={};"encodedDiagram"in e&&e.encodedDiagram!==document.appData.encodedDiagram&&(document.appData.encodedDiagram=
e.encodedDiagram,m.diagram=!0);"index"in e&&e.index!==document.appData.index&&(document.appData.index=e.index,m.index=!0);"numberOfDiagramPages"in e&&e.numberOfDiagramPages!==document.appData.numberOfDiagramPages&&(document.appData.numberOfDiagramPages=e.numberOfDiagramPages,m.numberOfDiagramPages=!0);"appConfig"in e&&e.appConfig!==document.appConfig&&(document.appConfig=e.appConfig,m.appConfig=!0)}else m={};g=m;return!0!==c.data.synchronize?n.jumpTo(2):f||g.diagram||g.index||g.appConfig?n.yield(d(c.data.sender),
3):n.jumpTo(3)}2!=n.nextAddress&&((f||g.numberOfDiagramPages)&&updatePaginator(),(f||g.numberOfDiagramPages||g.index)&&updatePaginatorSelection(),g.appConfig&&applyConfig());!0===c.data.reload&&window.location.reload();n.jumpToEnd()})};var receiveMsg=function(c){return function(d){c({data:d.detail.data})}}(function(c){function d(n){var m,h,p,l,k,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return document.appConfig.autoRefreshState="syncing",m=document.appData.encodedDiagram,h=document.appData.index,"url"!==n&&document.getElementById("url")&&setUrlValue(void 0,{encodedDiagram:m,index:h},{suppressEditorChangedMessage:!0}),r.yield(setDiagram(document.appConfig.diagramPreviewType,m,h),2);p=$jscomp.makeIterator(document.getElementsByClassName("diagram-link"));for(l=p.next();!l.done;l=p.next())k=l.value,k.href=buildUrl(k.dataset.imgType,m,h);q=replaceUrl(window.location.href,m,h).url;history.replaceState(history.stat,document.title,q);document.appConfig.autoRefreshState="complete";r.jumpToEnd()})}var e,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(1==n.nextAddress){e=c.data.data;f=c.data.force||!1;if(e&&0!==Object.keys(e).length){var m={};"encodedDiagram"in e&&e.encodedDiagram!==document.appData.encodedDiagram&&(document.appData.encodedDiagram=e.encodedDiagram,m.diagram=!0);"index"in e&&e.index!==document.appData.index&&(document.appData.index=e.index,m.index=!0);"numberOfDiagramPages"in e&&e.numberOfDiagramPages!==document.appData.numberOfDiagramPages&&(document.appData.numberOfDiagramPages=e.numberOfDiagramPages,m.numberOfDiagramPages=!0);"appConfig"in e&&e.appConfig!==document.appConfig&&(document.appConfig=e.appConfig,m.appConfig=!0)}else m={};g=m;return!0!==c.data.synchronize?n.jumpTo(2):f||g.diagram||g.index||g.appConfig?n.yield(d(c.data.sender),3):n.jumpTo(3)}2!=n.nextAddress&&((f||g.numberOfDiagramPages)&&updatePaginator(),(f||g.numberOfDiagramPages||g.index)&&updatePaginatorSelection(),g.appConfig&&applyConfig());!0===c.data.reload&&window.location.reload();n.jumpToEnd()})});window.addEventListener('plantuml-message',receiveMsg);return receiveMsg}}}(),sendMessage=$jscomp$destructuring$var17.sendMessage,suppressNextMessage=$jscomp$destructuring$var17.suppressNextMessage,initAppCommunication=$jscomp$destructuring$var17.initAppCommunication;
function makeRequest(a,b,c){c=void 0===c?{}:c;return PlantUmlLanguageFeatures.makeRequest(a,b,{data:void 0===c.data?null:c.data,headers:void 0===c.headers?{"Content-Type":"text/plain"}:c.headers,responseType:void 0===c.responseType?"text":c.responseType,baseUrl:void 0===c.baseUrl?"":c.baseUrl})}
var $jscomp$destructuring$var21=function(){var a={changeEventsEnabled:!0,autoRefreshState:"disabled",theme:void 0,diagramPreviewType:"png",editorWatcherTimeout:500,editorCreateOptions:{automaticLayout:!0,fixedOverflowWidgets:!0,minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},scrollBeyondLastLine:!1,tabSize:2,theme:"vs"}},b;document.appConfig=Object.assign({},null==(b=window.opener)?void 0:b.document.appConfig);0===Object.keys(document.appConfig).length&&(document.appConfig=JSON.parse(localStorage.getItem("document.appConfig"))||
a);return{applyConfig:function(){setTheme(document.appConfig.theme);var c;null==(c=document.editor)||c.updateOptions(document.appConfig.editorCreateOptions);var d;null==(d=document.settingsEditor)||d.updateOptions(document.appConfig.editorCreateOptions)},updateConfig:function(c){localStorage.setItem("document.appConfig",JSON.stringify(c));sendMessage({sender:"config",data:{appConfig:c},synchronize:!0})}}}(),applyConfig=$jscomp$destructuring$var21.applyConfig,updateConfig=$jscomp$destructuring$var21.updateConfig;
(function(){function a(b){if(!b)return"https://www.plantuml.com/plantuml";b=String(b).trim();/^https:\/\//i.test(b)||(b="https://"+b.replace(/^http:\/\//i,""));return b.replace(/\/+$/,"")}window.getPlantumlBase=function(){var b=localStorage.getItem("plantuml_base");return a(b||"https://www.plantuml.com/plantuml")};window.setPlantumlBase=function(b){localStorage.setItem("plantuml_base",a(b))}})();function removeChildren(a){a.replaceChildren?a.replaceChildren():a.innerHTML=""}
function isVisible(a){return null!==a.offsetParent}function setVisibility(a,b,c){c=void 0===c?!1:c;b?(a.style.removeProperty("display"),c&&a.focus()):a.style.display="none"}var isMac=function(){var a,b,c;return((null==(a=navigator)?void 0:null==(b=a.userAgentData)?void 0:b.platform)||(null==(c=navigator)?void 0:c.platform)||"unknown").match("Mac")}();function setTheme(a){document.documentElement.setAttribute("data-theme",a)}
function initTheme(){function a(d){"dark"===d&&"vs"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs-dark");"light"===d&&"vs-dark"===document.appConfig.editorCreateOptions.theme&&(document.appConfig.editorCreateOptions.theme="vs")}var b=document.appConfig,c;(c=document.appConfig.theme)||(c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":void 0);b.theme=c||"light";setTheme(document.appConfig.theme);
a(document.appConfig.theme);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(d){d=d.matches?"dark":"light";document.appConfig.theme=d;a(d);updateConfig(document.appConfig)})}function resolvePath(a){return PlantUmlLanguageFeatures.absolutePath(a)}
function prepareUrl(a){a instanceof URL||(a=new URL(resolvePath(a)));var b=(new URL((document.querySelector("base")||{}).href||window.location.origin)).pathname;"/"===b.slice(-1)&&(b=b.slice(0,-1));b=a.pathname.startsWith(b)?a.pathname.slice(b.length):a.pathname;var c=/\/\w+(?:\/(\d+))?(?:\/([^/]+))?\/?$/gm.exec(b);return[a,b,{idx:c?c[1]:void 0,encoded:c?c[2]:void 0}]}
function analyseUrl(a){var b=$jscomp.makeIterator(prepareUrl(a));a=b.next().value;b.next();b=b.next().value;return{index:b.idx,encodedDiagram:b.encoded||a.searchParams.get("url")}}
function replaceUrl(a,b,c){var d=$jscomp.makeIterator(prepareUrl(a));a=d.next().value;var e=d.next().value;d=d.next().value.encoded;var f=e.slice(1);f=f.slice(0,f.indexOf("/"));c&&0<=c&&(f+="/"+c);d&&(f+="/"+b);"/"===e.slice(-1)&&(f+="/");a.pathname=(new URL(resolvePath(f))).pathname;a.searchParams.get("url")&&a.searchParams.set("url",b);return{url:a,pathname:f}}
function buildUrl(a,b,c){c&&0<=c&&(a+="/"+c);a+="/"+b;var d="function"===typeof getPlantumlBase?getPlantumlBase():"https://www.plantuml.com/plantuml";console.log("🔧 buildUrl - base:",d,"pathname:",a);if(d){var e=a.startsWith("/")?d+a:d+"/"+a;console.log("✅ buildUrl result:",e);return e}return a};